"use strict";(self.webpackChunk_pyviz_jupyterlab_pyviz=self.webpackChunk_pyviz_jupyterlab_pyviz||[]).push([[445],{445:(e,t,n)=>{n.r(t),n.d(t,{default:()=>M});var o=n(779),i=n(175),s=n(764),r=n(58),a=n(263),d=n(85),l=n(308),c=n(923),m=n(667);const h='<?xml version="1.0" encoding="UTF-8" standalone="no"?>\n<svg\n   xmlns:dc="http://purl.org/dc/elements/1.1/"\n   xmlns:cc="http://creativecommons.org/ns#"\n   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"\n   xmlns:svg="http://www.w3.org/2000/svg"\n   xmlns="http://www.w3.org/2000/svg"\n   width="63.84808mm"\n   height="63.912464mm"\n   viewBox="0 0 63.84808 63.912464"\n   version="1.1"\n   id="svg867">\n  <defs\n     id="defs861" />\n  <metadata\n     id="metadata864">\n    <rdf:RDF>\n      <cc:Work\n         rdf:about="">\n        <dc:format>image/svg+xml</dc:format>\n        <dc:type\n           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />\n        <dc:title></dc:title>\n      </cc:Work>\n    </rdf:RDF>\n  </metadata>\n  <g\n     id="layer1"\n     transform="translate(-41.403339,-133.59734)">\n    <g\n       id="g5614"\n       transform="matrix(0.56444446,0,0,0.56444446,819.73897,-509.17309)">\n      <rect\n         y="1138.7665"\n         x="-1378.941"\n         height="113.23074"\n         width="113.11668"\n         id="rect4136-8-8-1"\n         style="opacity:1;fill:#0072b5;fill-opacity:1;stroke:none;stroke-width:4;stroke-miterlimit:1;stroke-dasharray:none"\n         ry="9.4330282" />\n      <g\n         id="g5603">\n        <g\n           id="g5591">\n          <rect\n             y="1165.5731"\n             x="-1361.4104"\n             height="8"\n             width="78.055412"\n             id="rect4327-3-71"\n             style="opacity:1;fill:#eeeeee;fill-opacity:1;stroke:none;stroke-width:4;stroke-miterlimit:1;stroke-dasharray:none" />\n          <circle\n             r="9"\n             cy="1169.5731"\n             cx="-1341.4192"\n             id="path4355-79-2"\n             style="opacity:1;fill:#eeeeee;fill-opacity:1;stroke:none;stroke-width:4;stroke-miterlimit:1;stroke-dasharray:none" />\n        </g>\n        <g\n           id="g5595">\n          <rect\n             y="1191.3817"\n             x="-1361.4104"\n             height="8"\n             width="78.055412"\n             id="rect4327-5-1-0"\n             style="opacity:1;fill:#eeeeee;fill-opacity:1;stroke:none;stroke-width:4;stroke-miterlimit:1;stroke-dasharray:none" />\n          <circle\n             r="9"\n             cy="1195.3817"\n             cx="-1305.4111"\n             id="path4355-7-3-7"\n             style="opacity:1;fill:#eeeeee;fill-opacity:1;stroke:none;stroke-width:4;stroke-miterlimit:1;stroke-dasharray:none" />\n        </g>\n        <g\n           id="g5599">\n          <rect\n             y="1217.1904"\n             x="-1361.4104"\n             height="8"\n             width="78.055412"\n             id="rect4327-54-6-2"\n             style="opacity:1;fill:#eeeeee;fill-opacity:1;stroke:none;stroke-width:1;stroke-miterlimit:4;stroke-dasharray:none" />\n          <circle\n             r="9"\n             cy="1221.1904"\n             cx="-1341.4274"\n             id="path4355-3-9-8"\n             style="opacity:1;fill:#eeeeee;fill-opacity:1;stroke:none;stroke-width:4;stroke-miterlimit:1;stroke-dasharray:none" />\n        </g>\n      </g>\n    </g>\n  </g>\n</svg>\n',p=new m.LabIcon({name:"@pyviz/jupyterlab_pyviz:panel",svgstr:h});class u{constructor(e,t){this._context=e,this._wManager=t,this._comm=null,e.sessionContext.statusChanged.connect(((e,t)=>{"restarting"!==t&&"dead"!==t||(this._comm=null)}),this)}get context(){return this._context}get comm(){var e,t;return null==this._context.sessionContext?null:(null===this._comm&&null!==(null===(e=this._context.sessionContext.session)||void 0===e?void 0:e.kernel)&&(this._comm=null===(t=this._context.sessionContext.session)||void 0===t?void 0:t.kernel.createComm("hv-extension-comm"),null!=this._comm&&this._comm.open()),this._comm)}set comm(e){this._comm=e}get isDisposed(){return null===this._context}dispose(){this.isDisposed||(this._context=null,this._comm=null)}}var g=n(676),_=n(526),w=n(840),v=n(271);const y=new _.Token("@pyviz/jupyterlab_pyviz:IPanelPreviewTracker");class f extends s.IFrame{constructor(e={}){super(e),this.srcdoc=e.srcdoc||null}get srcdoc(){return this._srcdoc}set srcdoc(e){this._srcdoc=e;const t=this.node.querySelector("iframe");null!=e&&(t.setAttribute("srcdoc",e),t.addEventListener("load",(()=>t.removeAttribute("srcdoc"))))}}const x=`\n<!DOCTYPE html>\n<html>\n<head>\n  <title>Jupyter Kernel Starting</title>\n  <style>\n    body {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      flex-direction: column;\n      height: 100vh;\n      background-color: #f7f7f7;\n      font-family: Futura;\n    }\n\n    .loading-container {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      margin: 20px 0;\n    }\n\n    .loading-indicator {\n      width: 100px;\n      height: 100px;\n      border: 8px solid rgb(48, 112, 146);\n      border-top-color: #f7f7f7;\n      border-radius: 50%;\n      animation: spin 1s infinite linear;\n    }\n\n    @keyframes spin {\n      from {\n        transform: rotate(0deg);\n      }\n      to {\n        transform: rotate(360deg);\n      }\n    }\n  </style>\n</head>\n<body>\n  ${h}\n  <h1>Panel Preview Launching...</h1>\n  <div class="loading-container">\n    <div class="loading-indicator"></div>\n  </div>\n</body>\n</html>\n`;class k extends g.DocumentWidget{constructor(e){super(Object.assign(Object.assign({},e),{content:new f({srcdoc:x,sandbox:["allow-same-origin","allow-scripts","allow-downloads"]})})),window.onmessage=e=>{var t,n,o,i,s;switch(null===(t=e.data)||void 0===t?void 0:t.level){case"debug":console.debug(...null===(n=e.data)||void 0===n?void 0:n.msg);break;case"info":console.info(...null===(o=e.data)||void 0===o?void 0:o.msg);break;case"warn":console.warn(...null===(i=e.data)||void 0===i?void 0:i.msg);break;case"error":console.error(...null===(s=e.data)||void 0===s?void 0:s.msg);break;default:console.log(e)}};const{getPanelUrl:t,context:n,renderOnSave:o}=e;this.content.url=t(n.path),this.content.title.icon=p,this._renderOnSave=null!=o&&o,n.pathChanged.connect((()=>{this.content.url=t(n.path)}));const i=new s.ToolbarButton({icon:m.refreshIcon,tooltip:"Reload Preview",onClick:()=>{this.reload()}}),r=s.ReactWidget.create(v.createElement("label",{className:"jp-PanelPreview-renderOnSave"},v.createElement("input",{name:"renderOnSave",type:"checkbox",defaultChecked:o,onChange:e=>{this._renderOnSave=e.target.checked}}),v.createElement("span",null,"Render on Save")));this.toolbar.addItem("reload",i),n&&(this.toolbar.addItem("renderOnSave",r),n.ready.then((()=>{n.fileChanged.connect((()=>{this.renderOnSave&&this.reload()}))})))}dispose(){this.isDisposed||(super.dispose(),w.Signal.clearData(this))}reload(){const e=this.content.node.querySelector("iframe");null!=e.contentWindow&&(e.parentElement.classList.add("jp-PanelPreview-loading"),e.contentWindow.location.reload(),e.addEventListener("load",(()=>{e.parentElement.classList.remove("jp-PanelPreview-loading")})))}get renderOnSave(){return this._renderOnSave}set renderOnSave(e){this._renderOnSave=e}}class b extends g.ABCWidgetFactory{constructor(e,t){super(t),this.getPanelUrl=e,this.defaultRenderOnSave=!1}createNewWidget(e){return new k({context:e,getPanelUrl:this.getPanelUrl,renderOnSave:this.defaultRenderOnSave})}}var P=n(832);const C="application/vnd.holoviews_load.v0+json",R="application/vnd.holoviews_exec.v0+json";class O extends P.Widget{constructor(e,t){super(),this._load_mimetype=C,this._script_element=document.createElement("script"),this._manager=t}renderModel(e){const t=e.data[this._load_mimetype];return this._script_element.textContent=t,this.node.appendChild(this._script_element),this._manager.comm,Promise.resolve()}}class z extends P.Widget{constructor(e,t){super(),this._html_mimetype="text/html",this._js_mimetype="application/javascript",this._exec_mimetype=R,this._createNodes(),this._manager=t,this._displayed=!1,this._dispose=!0}_createNodes(){this._div_element=document.createElement("div"),this._script_element=document.createElement("script"),this._script_element.setAttribute("type","text/javascript")}_registerKernel(e){var t;const n={create_view:(e,t)=>this._manager._wManager.create_view(e,t),set_state:e=>this._manager._wManager.set_state(e),display_view:(e,t)=>this._manager._wManager.display_view(e,t)};window.PyViz.widget_manager=n;const o=null===(t=this._manager.context.sessionContext.session)||void 0===t?void 0:t.kernel,i={connectToComm:(e,t)=>{if(void 0===o)return console.log("Kernel not found, could not connect to comm target ",e),{open:function(){},send:function(){},onMsg:function(){}};const n=o.createComm(e,t);return{set onMsg(e){n.onMsg=e},open:(e,t,o)=>{n.open(e,t,o)},send:(e,t,o,i)=>{n.isDisposed||n.send(e,t,o,i)}}},registerCommTarget:(e,t)=>{if(void 0!==o)return o.registerCommTarget(e,t);console.log("Kernel not found, could not register comm target ",e)}};window.PyViz.kernels[e]=i,this._manager.context.sessionContext.statusChanged.connect(((t,n)=>{"restarting"!==n&&"dead"!==n||(delete window.PyViz.kernels[e],this._dispose=!1)}),this)}renderModel(e){const t=e.metadata[this._exec_mimetype],n=t.id;if(this._displayed&&(this._disposePlot(),this.node.removeChild(this._div_element),this.node.removeChild(this._script_element),this._createNodes()),this._dispose=!0,void 0!==n){void 0===window.PyViz?window.PyViz={comms:{},comm_status:{},kernels:{},receivers:{},plot_index:[]}:void 0===window.PyViz.plot_index&&(window.PyViz.plot_index={});const t=e.data[this._html_mimetype];this._div_element.innerHTML=t;const o=[],i=this._div_element.querySelectorAll("script");for(const e in i)i.hasOwnProperty(e)&&o.push(i[e]);if(o.forEach((e=>{const t=document.createElement("script"),n=[],o=e.attributes;for(const e in o)o.hasOwnProperty(e)&&n.push(o[e]);n.forEach((e=>t.setAttribute(e.name,e.value))),t.appendChild(document.createTextNode(e.innerHTML)),e.parentNode.replaceChild(t,e)})),this.node.appendChild(this._div_element),this._js_mimetype in e.data){const t=e.data[this._js_mimetype];this._script_element.textContent=t,this.node.appendChild(this._script_element)}this._registerKernel(n),this._displayed=!0,this._document_id=n}else if(void 0!==t.server_id){this._server_id=t.server_id;const n=e.data[this._html_mimetype],o=document.createElement("div");o.innerHTML=n;const i=o.children[0],s=[],r=i.attributes;for(const e in r)r.hasOwnProperty(e)&&s.push(r[e]);s.forEach((e=>this._script_element.setAttribute(e.name,e.value))),this._script_element.appendChild(document.createTextNode(i.innerHTML)),this.node.appendChild(this._script_element)}return Promise.resolve().then((()=>{void 0!==window.Bokeh&&n in window.Bokeh.index?window.PyViz.plot_index[n]=window.Bokeh.index[n]:window.PyViz.plot_index[n]=null}))}_disposePlot(){if(this._server_id)null!=this._manager.comm&&this._dispose&&this._manager.comm.send({event_type:"server_delete",id:this._server_id}),this._server_id=null;else if(this._document_id){const e=this._document_id;if(null!=this._manager.comm&&this._dispose&&this._manager.comm.send({event_type:"delete",id:e}),void 0!==window.PyViz&&(void 0!==window.PyViz.kernels&&delete window.PyViz.kernels[e],void 0!==window.PyViz.plot_index&&delete window.PyViz.plot_index[e]),void 0!==window.Bokeh&&e in window.Bokeh.index){const t=window.Bokeh.index[e].model.document;t.clear();const n=window.Bokeh.documents.indexOf(t);n>-1&&window.Bokeh.documents.splice(n,1)}this._document_id=null}}dispose(){this.isDisposed||(super.dispose(),this._disposePlot(),this._manager=null)}}let S=null;try{const e=n(294);S=e.registerWidgetManager}catch(e){console.log("Could not load ipywidgets support for @pyviz/jupyterlab_pyviz")}var T;!function(e){e.panelRender="notebook:render-with-panel",e.panelOpen="notebook:open-with-panel",e.lumenRender="notebook:render-with-lumen",e.lumenOpen="notebook:open-with-lumen"}(T||(T={}));class E{constructor(e){this._commands=e}createNew(e){const t=new s.ToolbarButton({className:"panelRender",tooltip:"Render with Panel",icon:p,onClick:()=>{this._commands.execute(T.panelRender)}});return e.toolbar.insertAfter("cellType","panelRender",t),t}}class W{constructor(e){this._commands=e}createNew(e){const t=new s.ToolbarButton({className:"lumenRender",tooltip:"Render with Lumen",icon:p,onClick:()=>{this._commands.execute(T.lumenRender)}});return e.toolbar.addItem("lumenRender",t),t}}class N{createNew(e,t){const n=this._docmanager._findContext(t.path,"notebook"),o={manager:null};null!=S&&S(n,e.content.rendermime,[o]);const i=new u(t,o.manager);return e.content.rendermime.addFactory({safe:!1,mimeTypes:[C],createRenderer:e=>new O(e,i)},-1),e.content.rendermime.addFactory({safe:!1,mimeTypes:[R],createRenderer:e=>new z(e,i)},-1),new c.DisposableDelegate((()=>{e.content.rendermime&&e.content.rendermime.removeMimeType(R),i.dispose()}))}}const j={id:"@pyviz/jupyterlab_pyviz:plugin",autoStart:!0,requires:[a.IDocumentManager,o.INotebookTracker],optional:[s.ICommandPalette,i.ILayoutRestorer,l.IMainMenu,d.ISettingRegistry],provides:y,activate:(e,t,n,o,i,a,d)=>{const l=new N;l._docmanager=t,e.docRegistry.addWidgetExtension("Notebook",l);const c=new s.WidgetTracker({namespace:"panel-preview"});function m(t){const o=n.currentWidget;return!1!==t.activate&&o&&e.shell.activateById(o.id),o}function h(){const t=e.shell.currentWidget;return null!=t&&null!=t.context&&(t.context.path.endsWith(".yaml")||t.context.path.endsWith(".yml")||null!==n.currentWidget&&n.currentWidget===t)}function p(e){return`${r.PageConfig.getBaseUrl()}panel-preview/render/${e}`}i&&i.restore(c,{command:"docmanager:open",args:e=>({path:e.context.path,factory:u.name}),name:e=>e.context.path,when:e.serviceManager.ready});const u=new b(p,{name:"Panel-preview",fileTypes:["notebook"],modelName:"notebook"}),g=new b(p,{name:"Lumen-preview",fileTypes:["yaml","yml","text","py"],modelName:"text"});u.widgetCreated.connect(((e,t)=>{t.context.pathChanged.connect((()=>{c.save(t)})),c.add(t)})),g.widgetCreated.connect(((e,t)=>{c.add(t)}));const _=e=>{u.defaultRenderOnSave=e.get("renderOnSave").composite};d&&Promise.all([d.load(j.id),e.restored]).then((([e])=>{_(e),e.changed.connect(_)})).catch((e=>{console.error(e.message)})),e.docRegistry.addWidgetFactory(u),e.docRegistry.addWidgetFactory(g);const{commands:w,docRegistry:v}=e;if(w.addCommand(T.panelRender,{label:"Render Notebook with Panel",execute:async e=>{const t=m(e);let n;t&&(n=t.context,await n.save(),w.execute("docmanager:open",{path:n.path,factory:"Panel-preview",options:{mode:"split-right"}}))},isEnabled:h}),w.addCommand(T.lumenRender,{label:"Render Yaml with Lumen",execute:async t=>{const n=e.shell.currentWidget;let o;n&&(o=n.context,await o.save(),w.execute("docmanager:open",{path:o.path,factory:"Lumen-preview",options:{mode:"split-right"}}))},isEnabled:h}),w.addCommand(T.panelOpen,{label:"Open with Panel in New Browser Tab",execute:async e=>{const t=m(e);if(!t)return;await t.context.save();const n=p(t.context.path);window.open(n)},isEnabled:h}),o){const e="Notebook Operations";[T.panelRender,T.panelOpen].forEach((t=>{o.addItem({command:t,category:e})}))}a&&a.viewMenu.addGroup([{command:T.panelRender},{command:T.panelOpen}],1e3);const y=new E(w);v.addWidgetExtension("Notebook",y);const f=new W(w);return v.addWidgetExtension("Editor",f),c}},M=j}}]);